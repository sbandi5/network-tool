package com.cybersec.controller;

import com.cybersec.exploit.BruteForceSimulator;
import com.cybersec.exploit.ExploitEngine;
import org.springframework.web.bind.annotation.*;

import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/exploit")
public class ExploitController {

    private final ExploitEngine exploitEngine;
    private final BruteForceSimulator bruteForceSimulator;

    public ExploitController(ExploitEngine exploitEngine, BruteForceSimulator bruteForceSimulator) {
        this.exploitEngine = exploitEngine;
        this.bruteForceSimulator = bruteForceSimulator;
    }

    @GetMapping("/run")
    public Map<String, String> runExploit(@RequestParam String target, @RequestParam int port) {
        return exploitEngine.runExploit(target, port);
    }

    @GetMapping("/brute-ssh")
    public Map<String, String> bruteSsh(@RequestParam String target, @RequestParam int port) {
        return bruteForceSimulator.bruteForce(target, port);
    }

    @GetMapping("/brute-log")
    public List<String> readBruteForceLog() {
        try {
            return Files.readAllLines(Paths.get("bruteforce-log.txt"));
        } catch (Exception e) {
            return List.of("Error reading log: " + e.getMessage());
        }
    }
}