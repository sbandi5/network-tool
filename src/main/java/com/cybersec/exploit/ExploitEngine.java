package com.cybersec.exploit;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.Socket;
import java.util.HashMap;
import java.util.Map;

import org.springframework.stereotype.Service;

@Service
public class ExploitEngine {

    public Map<String, String> runExploit(String target, int port) {
        Map<String, String> result = new HashMap<>();
        result.put("target", target);
        result.put("port", String.valueOf(port));

        try (Socket socket = new Socket(target, port);
             BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()))) {

            String banner = reader.readLine();
            result.put("banner", banner != null ? banner : "unknown");

            // Simulated vulnerability check
            if (banner != null && banner.toLowerCase().contains("ftp")) {
                result.put("exploit", "Anonymous FTP Login Vulnerability Detected");
            } else if (banner != null && banner.toLowerCase().contains("apache")) {
                result.put("exploit", "Outdated Apache Version Possible");
            } else {
                result.put("exploit", "No known vulnerability detected");
            }

        } catch (Exception e) {
            result.put("status", "Failed to connect or read banner");
        }

        return result;
    }
}